<!DOCTYPE html>


<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XMES</title>
  <!-- Favicon link -->
  <link rel="icon" type="image/png" href="/assets/favicon.ico">
  <link rel="stylesheet" type="text/css" href="templates/css/reset.css">
  <link rel="stylesheet" type="text/css" href="templates/css/main.css">
  <script src="templates/global.js"></script>
    
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const sidebarLinks = document.querySelectorAll('.sidebar a');
        sidebarLinks.forEach(link => {
            link.removeEventListener('click', handleSidebarLinkClick);
            link.addEventListener('click', handleSidebarLinkClick);
        });

        // Optionally load the last content or a default view, without highlighting any sidebar link
        loadLastContent(false); // Pass false to indicate not to highlight the link
    });

    function loadContent(url, highlight = true) {
        fetch(url)
            .then(response => response.text())
            .then(html => {
                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = html;

                // Update link highlight based on the 'highlight' flag
                if (highlight) {
                    const sidebarLinks = document.querySelectorAll('.sidebar a');
                    sidebarLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href').includes(url.replace('/', ''))) {
                            link.classList.add('active');
                        }
                    });
                }

                // Check if loaded URL is for the Machine Dashboard
                if (url.includes('/link2')) {
                    updateMachineBorders();  // Call this function only when the Machine Dashboard link is clicked
                }
                
                contentDiv.style.display = 'block';
            })
            .catch(error => console.error('Error loading content:', error));
    }

    function handleSidebarLinkClick(event) {
        event.preventDefault();
        const href = event.currentTarget.getAttribute('href').replace('javascript:loadContent(\'', '').replace('\')', '');
        loadContent(href);
        localStorage.setItem('lastLoadedContent', href);
        sessionStorage.setItem('lastSessionTime', Date.now().toString());
    }

    function loadLastContent(highlight) {
        const lastContent = localStorage.getItem('lastLoadedContent');
        if (lastContent) {
            loadContent(lastContent, highlight);
        } else {
            loadContent('/home', highlight);
        }
    }

    function checkSession() {
        const currentTime = Date.now();
        const lastSessionTime = parseInt(sessionStorage.getItem('lastSessionTime') || 0);

        if (!lastSessionTime || currentTime - lastSessionTime > 1800000) {
            sessionStorage.clear();
            sessionStorage.setItem('sessionActive', 'true');
            loadContent('/home', false);  // Do not highlight on session timeout
        } else {
            loadLastContent(true); // Highlight since this is a continuation of a session
        }
        sessionStorage.setItem('lastSessionTime', currentTime.toString());
    }
  </script>

</head>
<body onload="loadLastContent()" class ="index-page">
<div class="header">
    <figure>
        <img src="/assets/XMES_Logo_380x100.png" alt="XMES Logo">
    </figure>    
</div>
<div class="container">
    <div class="sidebar">
        <ul>
            <li><a href="javascript:loadContent('/home')">Home</a></li>
            <li><a href="javascript:loadContent('/production')">Production</a></li>
            <li><a href="javascript:loadContent('/link2')">Machine Dashboard</a></li>
            <li><a href="javascript:loadContent('/link3')">Order Dashboard</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="content" id="content">
            <h3>Content Body</h3>
            <p>This is the content body section.</p>            
        </div>
    </div>
</div>
</body>
</html>
