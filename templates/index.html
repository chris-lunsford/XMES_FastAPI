<!DOCTYPE html>


<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XMES</title>
  <!-- Favicon link -->
  <link rel="icon" type="image/png" href="/assets/favicon.ico">
  <link rel="stylesheet" type="text/css" href="templates/css/reset.css">
  <link rel="stylesheet" type="text/css" href="templates/css/main.css">
  <link rel="stylesheet" type="text/css" href="templates/css/machine_dashboard.css">
 
</head>
<body onload="loadLastContent()" class ="index-page">
<div class="header">
    <figure>
        <img src="/assets/XMES_Logo_380x100.png" alt="XMES Logo">
    </figure>    
</div>
<div class="container">
    <div class="sidebar">
        <ul>
            <!-- <li><a href="javascript:loadContent('/home')">Home</a></li> -->
            <li><a href="javascript:loadContent('/production')">Production<br>(WIP)</a></li>
            <li><a href="javascript:loadContent('/link2')">Machine Dashboard</a></li>
            <!-- <li><a href="javascript:loadContent('/link3')">Order Dashboard</a></li> -->
        </ul>
    </div>
    <div class="main-content">
        <div class="content" id="content">
            <h3>Content Body</h3>
            <p>This is the content of Index.</p>            
        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const sidebarLinks = document.querySelectorAll('.sidebar a');
        sidebarLinks.forEach(link => {
            link.removeEventListener('click', handleSidebarLinkClick);
            link.addEventListener('click', handleSidebarLinkClick);
        });
    
        // Optionally load the last content or a default view, without highlighting any sidebar link
        loadLastContent(false); // Pass false to indicate not to highlight the link
    });
    
    function loadScript(url) {
        const script = document.createElement('script');
        script.src = url;
        script.async = true;
        document.head.appendChild(script);
    }
    
    function loadContent(url, highlight = true) {
        fetch(url)
            .then(response => response.text())
            .then(html => {
                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = html;
    
                // Update link highlight based on the 'highlight' flag
                if (highlight) {
                    const sidebarLinks = document.querySelectorAll('.sidebar a');
                    sidebarLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href').includes(url.replace('/', ''))) {
                            link.classList.add('active');
                        }
                    });
                }
    
                // Dynamic script loading based on the content loaded
                if (url.includes('/link2')) {  // Assuming '/link2' is the path for the Machine Dashboard
                    loadScript('templates/machineDashboardEventHandlers.js');
                } else if (url.includes('/production')) {  // Assuming '/production' is the path for the Production Dashboard
                    loadScript('templates/productionDashboardEventHandlers.js');
                }
    
                // Initialize or update specific functionalities for each dashboard if needed
                if (url.includes('/link2')) {
                    // These could be moved to machineDashboardEventHandlers.js if they are scripts
                    updateMachineBorders();
                    initializeDateInputs();
                    autoSubmitForm();
                }
    
                // Dynamically load specific scripts based on the content loaded
                if (url.includes('/production')) {
                    loadScript('templates/productionDashboardEventHandlers.js');
                }
        
                contentDiv.style.display = 'block';
            })
            .catch(error => console.error('Error loading content:', error));
    }
    
    function handleSidebarLinkClick(event) {
        event.preventDefault();
        const href = event.currentTarget.getAttribute('href').replace('javascript:loadContent(\'', '').replace('\')', '');
        loadContent(href);
        localStorage.setItem('lastLoadedContent', href);
        sessionStorage.setItem('lastSessionTime', Date.now().toString());
    }
    
    function loadLastContent(highlight) {
        const lastContent = localStorage.getItem('lastLoadedContent');
        if (lastContent) {
            loadContent(lastContent, highlight);
        } else {
            loadContent('/home', highlight);  // Assuming '/home' is a valid path
        }
    }
    
    function checkSession() {
        const currentTime = Date.now();
        const lastSessionTime = parseInt(sessionStorage.getItem('lastSessionTime') || 0);
    
        if (!lastSessionTime || currentTime - lastSessionTime > 1800000) {
            sessionStorage.clear();
            sessionStorage.setItem('sessionActive', 'true');
            loadContent('/home', false);  // Do not highlight on session timeout
        } else {
            loadLastContent(true);  // Highlight since this is a continuation of a session
        }
        sessionStorage.setItem('lastSessionTime', currentTime.toString());
    }
    </script>
<script src="templates/global.js"></script>

</body>
</html>
