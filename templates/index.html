<!DOCTYPE html>


<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XMES</title>
  <!-- Favicon link -->
  <link rel="icon" type="image/png" href="/assets/favicon.ico">
  <link rel="stylesheet" type="text/css" href="templates/css/reset.css">
  <link rel="stylesheet" type="text/css" href="templates/css/main.css">
  <script src="templates/global.js"></script>
    
  <script>
    function loadContent(url) {
      localStorage.setItem('lastLoadedContent', url);  // Save the current content URL to localStorage
      fetch(url)
          .then(response => response.text())
          .then(html => {
              const contentDiv = document.getElementById('content');
              contentDiv.innerHTML = html;

              // Find and execute script tags in the loaded content
              const scripts = contentDiv.querySelectorAll('script');
              scripts.forEach(script => {
                  const newScript = document.createElement('script');
                  newScript.text = script.text;
                  document.head.appendChild(newScript).parentNode.removeChild(newScript);
              });

              // Ensure DOM is fully parsed
              setTimeout(() => {
                // Specific call for updateMachineBorders if link2.html is loaded
                if (url.includes('link2.html')) {
                  updateMachineBorders();
                }
              }, 0);

              contentDiv.style.display = 'block'; // Show the content div after it's loaded
          })
          .catch(error => {
              console.error('Error loading content:', error);
              contentDiv.style.display = 'block'; // Show the content div even if there's an error
          });
    }

    function handleSidebarLinkClick(event) {
      event.preventDefault();
      event.stopPropagation();

      const sidebarLinks = document.querySelectorAll('.sidebar a');
      sidebarLinks.forEach(node => node.classList.remove('active'));
      event.currentTarget.classList.add('active');

      const href = event.currentTarget.getAttribute('href').replace('javascript:loadContent(\'', '').replace('\')', '');
      loadContent(href);
    }

    document.addEventListener("DOMContentLoaded", function() {
      const lastContent = localStorage.getItem('lastLoadedContent');
      const sidebarLinks = document.querySelectorAll('.sidebar a');
      let activeSet = false;

      sidebarLinks.forEach(link => {
          link.removeEventListener('click', handleSidebarLinkClick); // Prevent duplication of event listeners
          link.addEventListener('click', handleSidebarLinkClick);

          // Set active class on reload based on last loaded content
          if (link.getAttribute('href').includes(lastContent)) {
              link.classList.add('active');
              activeSet = true; // Indicate that an active link has been set
          }
      });

      // Load last content only if no active link is set
      if (!activeSet && lastContent) {
          loadContent(lastContent);
      }
    });

    function loadLastContent() {
      const lastContent = localStorage.getItem('lastLoadedContent');
      if (lastContent && !document.querySelector('.sidebar a.active')) {
          loadContent(lastContent);
      } else {
          loadContent('/home'); // Default content if nothing is stored
      }
    }
  </script>

</head>
<body onload="loadLastContent()" class ="index-page">
<div class="header">
    <figure>
        <img src="/assets/XMES_Logo_380x100.png" alt="XMES Logo">
    </figure>    
</div>
<div class="container">
    <div class="sidebar">
        <ul>
            <li><a href="javascript:loadContent('/home')">Home</a></li>
            <li><a href="javascript:loadContent('/production')">Production</a></li>
            <li><a href="javascript:loadContent('/link2')">Machine Dashboard</a></li>
            <li><a href="javascript:loadContent('/link3')">Order Dashboard</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="content" id="content">
            <h3>Content Body</h3>
            <p>This is the content body section.</p>            
        </div>
    </div>
</div>
</body>
</html>
